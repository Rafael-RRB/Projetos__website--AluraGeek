class product{constructor(t,r,e,s,i){this._img=t,this._category=r,this._name=e,this._price=s,this._description=i}}class productHandler{constructor(t,r,e,s,i,o,a){if(this._img=t.toString(),this._imgFormatted='src="'+this._img+'"',this._category=this.formatString(r),this._name=this.formatString(e),this._price=parseFloat(s),this._priceFormatted=this._price.toLocaleString("pt-br",{minimumFractionDigits:2,maximumFractionDigits:2}),this._description=i,this._imgTest=regexImage.test(this._img),this._categoryTest=!(this._category.length<1||this._category.length>11),this._nameTest=!(this._name.length<3||this._name.length>12),this._priceTest=!(this._price<.99||this._price>9999.99),this._descriptionTest=!(this._description.length<20||this._description.length>100),!(this._imgTest&&this._categoryTest&&this._nameTest&&this._priceTest&&this._descriptionTest))throw"Invalid data: one or more parameters are not properly formatted.";if(0===o)productListArray.addProduct(new product(this._imgFormatted,this._category,this._name,this._priceFormatted,this._description));else{if(1!==o)throw"Invalid parameter: action should either be 0 (add) or 1 (edit).";productListArray.editProduct(new product(this._imgFormatted,this._category,this._name,this._priceFormatted,this._description),a)}}formatString(t){let r=(t=t.toString().toLocaleLowerCase()).match(/\b[^\s]+/g);for(let t=0;t<r.length;t++){let e=r[t][0].toLocaleUpperCase(),s=(()=>{let e=[];for(let s=1;s<r[t].length;s++)e.push(r[t][s]);return e})();r[t]=e+s.join("")}return r.join(" ")}}class productList{constructor(){this._productList=[]}addProduct(t){this._productList.push(t),localStorage.setItem("productListArray",JSON.stringify(this._productList))}editProduct(t,r){this._productList[r]=t,localStorage.setItem("productListArray",JSON.stringify(this._productList))}}class productView{constructor(t){this._array=t,this._categoryList=(()=>{var t=[[],[],[]],r=[],e=[];return(()=>{for(let t=0;t<this._array._productList.length;t++)r.includes(this._array._productList[t]._category)?e[r.indexOf(this._array._productList[t]._category)]+=1:(r.push(this._array._productList[t]._category),e[r.indexOf(this._array._productList[t]._category)]=1);for(var s=0;s<r.length;s++)e[s]<6&&(r.splice(s,1),e.splice(s,1),s--);r=this.randomArray(r,3);for(let e=0;e<this._array._productList.length;e++)switch(!0){case r[0].includes(this._array._productList[e]._category):t[0].push(this._array._productList[e]);break;case r[1].includes(this._array._productList[e]._category):t[1].push(this._array._productList[e]);break;case r[2].includes(this._array._productList[e]._category):t[2].push(this._array._productList[e])}})(),[this.randomArray(t[0],6),this.randomArray(t[1],6),this.randomArray(t[2],6)]})()}randomArray(t,r){var e=[].concat(t),s=[];r<1&&(r=1);for(let t=0;t<r;t++){let t=Math.floor(Math.random()*e.length);s.push(e[t]),e.splice(t,1)}return s}}null===sessionStorage.getItem("editProduct")||/\/novo_produto\.html$/.test(window.location.href)||sessionStorage.removeItem("editProduct");const hrefDocument=window.location.href,$=document.querySelector.bind(document),$$=document.querySelectorAll.bind(document),regexHREF=new RegExp(["/index.html$","/lista_produtos.html$","/novo_produto.html$","/produto.html$","/login.html$"].join("|"),"i"),regexHREFLogin=/\/login\.html$/;if(/\b\/index\.html\b/.test(hrefDocument))concatHref=["","html/"];else var concatHref=["../",""];function clearLocalStorage(){localStorage.clear(),sessionStorage.clear(),window.location.href="../html/index.html"}function classResult(t,r){!1===r?(t.classList.add("js__failure"),t.classList.remove("js__success")):!0===r?(t.classList.add("js__success"),t.classList.remove("js__failure")):(t.classList.remove("js__failure"),t.classList.remove("js__success"))}function labelResult(t,r,e){t.innerText=`${r} ${e}`}function addEventListenerForm(t,r,e,s,i,o,a){r.addEventListener(e,e=>{var c=s.length;if(""==r.value)labelResult(t.querySelector("p"),i,""),classResult(t,void 0);else{for(let e=0;e<s.length;e++)s[e].test(r.value)||(labelResult(t.querySelector("p"),o[e],"[X]"),c--);c<s.length?classResult(t,!1):(labelResult(t.querySelector("p"),a,"[✓]"),classResult(t,!0))}})}function clearForm(t,r){let e=t.querySelectorAll("label"),s=t.querySelectorAll("input,textarea");e.forEach((t,e,s)=>{s[e].querySelector("p").innerText=r[e],s[e].classList.remove("js__failure"),s[e].classList.remove("js__success")}),s.forEach((t,r,e)=>{e[r].value=""})}if(regexHREF.test(window.location.href)){var productListArray=new productList;if(null!==localStorage.getItem("productListArray")){var lsArray=JSON.parse(localStorage.getItem("productListArray"));for(let t=0;t<lsArray.length;t++)productListArray._productList[t]=new product(lsArray[t]._img,lsArray[t]._category,lsArray[t]._name,lsArray[t]._price,lsArray[t]._description)}else{function pImgSRC(t){return` \n srcset="img/products/product__${t}--size1.webp 126w,\n img/products/product__${t}--size2.webp 174w,\n img/products/product__${t}--size3.webp 261w,\n img/products/product__${t}--size4.webp 348w"\n sizes="(max-width: 280px) 126px,\n (max-width: 428px) 193px,\n (max-width: 768px) 216px,\n (max-width: 1024px) 296px,\n (max-width: 1280px) 152px,\n 100vw"\n src="img/products/product__${t}--size1.webp" alt="" `}function pName(t){return`Produto #${t}`}function pDesc(){return"Lorem ipsum dolor sit amet. Vel voluptates quaerat et esse amet sed quisquam similique ut obcaecati."}function pGenerate(t,r){for(let e=0;e<6;e++)productListArray._productList.push(new product(pImgSRC(r),t,pName(r),42..toLocaleString("pt-br",{minimumFractionDigits:2,maximumFractionDigits:2}),pDesc())),r++}pGenerate("Star Wars",1),pGenerate("Consoles",7),pGenerate("Diversos",13)}}const productListMain=$("main>.principal__lista-cartao");let tempArray=[];productListMain.innerHTML=(()=>{for(let t=0;t<productListArray._productList.length;t++)tempArray[t]=`\n    <article class="lista-cartoes__cartao">\n      <div class="cartao__imagem">\n        ${(()=>null===JSON.parse(sessionStorage.getItem("login"))?"":!0===JSON.parse(sessionStorage.getItem("login")).login?'\n              <button href="#" class="imagem__deletar">\n                <span class="hide-text">Deletar produto</span>\n              </button>\n              \n              <a href="#" class="imagem__editar">\n                <span class="hide-text">Editar produto.</span>\n              </a>\n              ':void 0)()}\n      </div>\n  \n      <a href="lista_produtos.html" class="cartao__descricao">\n        <h2 class="descricao__titulo">${productListArray._productList[t]._name}</h2>\n        <p class="descricao__preco">R$${productListArray._productList[t]._price}</p>\n        <p class="descricao__link">Ver produto</p>\n      </a>\n    </article>\n    `;return tempArray.join(" ")})();let htmlCardList=$$(".lista-cartoes__cartao>.cartao__imagem");for(let t=0;t<htmlCardList.length;t++)/http/g.test(productListArray._productList[t]._img)?htmlCardList[t].style.backgroundImage=`url(${(()=>`${productListArray._productList[t]._img.match(/src="([^"]+)/)[1]})`)()}`:htmlCardList[t].style.backgroundImage=`url(${(()=>`../${productListArray._productList[t]._img.match(/src="([^"]+)/)[1]})`)()}`;function productDeleteCond(){let t=(()=>{let t=[];for(let r=0;r<productListArray._productList.length;r++)t.includes(productListArray._productList[r]._category)||t.push(productListArray._productList[r]._category);return t})(),r=(()=>{let r=[];for(let e=0;e<t.length;e++){r[e]=0;for(let s=0;s<productListArray._productList.length;s++)t[e].includes(productListArray._productList[s]._category)&&(r[e]+=1)}return r})(),e=(()=>{let t=0;for(let e=0;e<r.length;e++)r[e]>5&&(t+=1);return t<3})();switch(!0){case productListArray._productList.length-1<18:return 0;case t.length<3:return 1;case e:return 2;default:return-1}}let productEdit=$$(".cartao__imagem>.imagem__editar");for(let t=0;t<productEdit.length;t++)productEdit[t].addEventListener("click",r=>{r.preventDefault(),sessionStorage.setItem("editProduct",JSON.stringify({edit:!0,index:t})),window.location.href="../html/novo_produto.html"});let productDelete=$$(".cartao__imagem>.imagem__deletar");for(let t=0;t<productDelete.length;t++)productDelete[t].addEventListener("click",r=>{switch(!0){case-1===productDeleteCond():confirm(`Você tem certeza que quer deletar "${productListArray._productList[t]._name}"?`)&&(productListArray._productList.splice(t,1),localStorage.setItem("productListArray",JSON.stringify(productListArray._productList)),location.reload());break;case 0===productDeleteCond():alert("Erro: é necessário haver um mínimo de 18 produtos.");break;case 1===productDeleteCond():alert("Erro: é necessário haver um mínimo de 3 categorias diferentes.");break;case 2===productDeleteCond():alert("Erro: é necessário haver pelo menos 6 produtos em 3 categorias diferentes.")}});let linkViewProduct=$$(".lista-cartoes__cartao>a");for(let t=0;t<linkViewProduct.length;t++)linkViewProduct[t].addEventListener("click",r=>{r.preventDefault();let e=productListArray._productList[t]._category,s=JSON.parse(JSON.stringify(productListArray._productList));s.splice(t,1);let i=[];sessionStorage.setItem("productOrderCurrent",JSON.stringify(productListArray._productList[t]));for(let t=0;t<s.length;t++)e===s[t]._category&&i.push(s[t]);(()=>{for(let t=0;i.length>5;t++){let t=Math.floor(Math.random()*i.length);i.splice(t,1)}})(),i=JSON.parse(JSON.stringify(i)),sessionStorage.setItem("productOrderCategoryList",JSON.stringify(i)),window.location.href="../html/produto.html"});null===sessionStorage.getItem("login")&&$(".heading__botao").remove();