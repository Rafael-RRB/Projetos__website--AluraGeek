class product{constructor(t,e,i,o,r){this._img=t,this._category=e,this._name=i,this._price=o,this._description=r}}class productHandler{constructor(t,e,i,o,r,n,a){if(this._img=t.toString(),this._imgFormatted='src="'+this._img+'"',this._category=this.formatString(e),this._name=this.formatString(i),this._price=parseFloat(o),this._priceFormatted=this._price.toLocaleString("pt-br",{minimumFractionDigits:2,maximumFractionDigits:2}),this._description=r,this._imgTest=regexImage.test(this._img),this._categoryTest=!(this._category.length<1||this._category.length>11),this._nameTest=!(this._name.length<3||this._name.length>12),this._priceTest=!(this._price<.99||this._price>9999.99),this._descriptionTest=!(this._description.length<20||this._description.length>100),!(this._imgTest&&this._categoryTest&&this._nameTest&&this._priceTest&&this._descriptionTest))throw"Invalid data: one or more parameters are not properly formatted.";if(0===n)productListArray.addProduct(new product(this._imgFormatted,this._category,this._name,this._priceFormatted,this._description));else{if(1!==n)throw"Invalid parameter: action should either be 0 (add) or 1 (edit).";productListArray.editProduct(new product(this._imgFormatted,this._category,this._name,this._priceFormatted,this._description),a)}}formatString(t){let e=(t=t.toString().toLocaleLowerCase()).match(/\b[^\s]+/g);for(let t=0;t<e.length;t++){let i=e[t][0].toLocaleUpperCase(),o=(()=>{let i=[];for(let o=1;o<e[t].length;o++)i.push(e[t][o]);return i})();e[t]=i+o.join("")}return e.join(" ")}}class productList{constructor(){this._productList=[]}addProduct(t){this._productList.push(t),localStorage.setItem("productListArray",JSON.stringify(this._productList))}editProduct(t,e){this._productList[e]=t,localStorage.setItem("productListArray",JSON.stringify(this._productList))}}class login{constructor(t,e){this._email=t,this._pwd=e}}class loginHandler{constructor(t,e){if(this._email=t,this._pwd=e,!regexEmail.test(this._email)||!regexPassword.test(this._pwd))throw Error("login credentials failed.");loginListArray.addLogin(new login(this._email,this._pwd))}}function simpleEncryption(t){let e="";for(let i=0;i<t.length;i++)e+=t.charCodeAt(i).toString(16);return e}function simpleDecryption(t){let e="";for(let i=0;i<t.length;i+=2){let o=t.charAt(i)+t.charAt(i+1);e+=String.fromCharCode(parseInt(o,16))}return e}class loginList{constructor(){this._loginList=[new login("admin","admin")],this._arrayEmail=["admin"],this._arrayPWD=["admin"]}updateLogin(){this._arrayEmail=[],this._arrayPWD=[];for(let t=0;t<this._loginList.length;t++)this._arrayEmail.push(this._loginList[t]._email),this._arrayPWD.push(this._loginList[t]._pwd)}addLogin(t){this._loginList.push(t),localStorage.setItem("key1",JSON.stringify(this.localStorageEncryption())),this.updateLogin()}localStorageEncryption(){let t=JSON.parse(JSON.stringify([].concat(this._loginList)));for(let e=0;e<this._loginList.length;e++)t[e]._email=simpleEncryption(t[e]._email),t[e]._pwd=simpleEncryption(t[e]._pwd);return t}}null===sessionStorage.getItem("editProduct")||/\/novo_produto\.html$/.test(window.location.href)||sessionStorage.removeItem("editProduct");const hrefDocument=window.location.href,$=document.querySelector.bind(document),$$=document.querySelectorAll.bind(document),regexHREF=new RegExp(["/index.html$","/lista_produtos.html$","/novo_produto.html$","/produto.html$","/login.html$"].join("|"),"i"),regexHREFLogin=/\/login\.html$/;if(/\b\/index\.html\b/.test(hrefDocument))concatHref=["","html/"];else var concatHref=["../",""];function clearLocalStorage(){localStorage.clear(),sessionStorage.clear(),window.location.href="../html/index.html"}function classResult(t,e){!1===e?(t.classList.add("js__failure"),t.classList.remove("js__success")):!0===e?(t.classList.add("js__success"),t.classList.remove("js__failure")):(t.classList.remove("js__failure"),t.classList.remove("js__success"))}function labelResult(t,e,i){t.innerText=`${e} ${i}`}function addEventListenerForm(t,e,i,o,r,n,a){e.addEventListener(i,i=>{var s=o.length;if(""==e.value)labelResult(t.querySelector("p"),r,""),classResult(t,void 0);else{for(let i=0;i<o.length;i++)o[i].test(e.value)||(labelResult(t.querySelector("p"),n[i],"[X]"),s--);s<o.length?classResult(t,!1):(labelResult(t.querySelector("p"),a,"[✓]"),classResult(t,!0))}})}function clearForm(t,e){let i=t.querySelectorAll("label"),o=t.querySelectorAll("input,textarea");i.forEach((t,i,o)=>{o[i].querySelector("p").innerText=e[i],o[i].classList.remove("js__failure"),o[i].classList.remove("js__success")}),o.forEach((t,e,i)=>{i[e].value=""})}if(regexHREF.test(window.location.href)){var productListArray=new productList;if(null!==localStorage.getItem("productListArray")){var lsArray=JSON.parse(localStorage.getItem("productListArray"));for(let t=0;t<lsArray.length;t++)productListArray._productList[t]=new product(lsArray[t]._img,lsArray[t]._category,lsArray[t]._name,lsArray[t]._price,lsArray[t]._description)}else{function pImgSRC(t){return` \n srcset="img/products/product__${t}--size1.webp 126w,\n img/products/product__${t}--size2.webp 174w,\n img/products/product__${t}--size3.webp 261w,\n img/products/product__${t}--size4.webp 348w"\n sizes="(max-width: 280px) 126px,\n (max-width: 428px) 193px,\n (max-width: 768px) 216px,\n (max-width: 1024px) 296px,\n (max-width: 1280px) 152px,\n 100vw"\n src="img/products/product__${t}--size1.webp" alt="" `}function pName(t){return`Produto #${t}`}function pDesc(){return"Lorem ipsum dolor sit amet. Vel voluptates quaerat et esse amet sed quisquam similique ut obcaecati."}function pGenerate(t,e){for(let i=0;i<6;i++)productListArray._productList.push(new product(pImgSRC(e),t,pName(e),42..toLocaleString("pt-br",{minimumFractionDigits:2,maximumFractionDigits:2}),pDesc())),e++}pGenerate("Star Wars",1),pGenerate("Consoles",7),pGenerate("Diversos",13)}}if("true"==sessionStorage.getItem("login"))alert("Você já efetuou login! redirecionando..."),window.location.replace("../index.html");else{var loginListArray=new loginList;if(null!==localStorage.getItem("key1")){lsArray=JSON.parse(localStorage.getItem("key1"));for(let t=1;t<lsArray.length;t++)loginListArray._loginList[t]=new login(lsArray[t]._email,lsArray[t]._pwd),loginListArray._loginList[t]._email=simpleDecryption(loginListArray._loginList[t]._email),loginListArray._loginList[t]._pwd=simpleDecryption(loginListArray._loginList[t]._pwd)}loginListArray.updateLogin()}const formLogin=$(".login__formulario:nth-of-type(1)"),inputLoginLabelEmail=$(".login__formulario:nth-child(1)>.formulario__container:nth-of-type(1)"),inputLoginEmail=$(".login__formulario:nth-child(1)>.formulario__container:nth-of-type(1)>.formulario__campo"),inputLoginLabelPWD=$(".login__formulario:nth-child(1)>.formulario__container:nth-of-type(2)"),inputLoginPWD=$(".login__formulario:nth-child(1)>.formulario__container:nth-of-type(2)>.formulario__campo"),buttonLogin=$(".login__formulario:nth-child(1)>.formulario__botao"),formNewAcc=$(".login__formulario:nth-of-type(2)"),inputNewAccLabelEmail=$(".login__formulario:nth-child(2)>.formulario__container:nth-of-type(1)"),inputNewAccEmail=$(".login__formulario:nth-child(2)>.formulario__container:nth-of-type(1)>.formulario__campo"),inputNewAccLabelPWD=$(".login__formulario:nth-child(2)>.formulario__container:nth-of-type(2)"),inputNewAccPWD=$(".login__formulario:nth-child(2)>.formulario__container:nth-of-type(2)>.formulario__campo"),inputNewAccLabelPWDConfirm=$(".login__formulario:nth-child(2)>.formulario__container:nth-of-type(3)"),inputNewAccPWDConfirm=$(".login__formulario:nth-child(2)>.formulario__container:nth-of-type(3)>.formulario__campo"),buttonNewAcc=$(".login__formulario:nth-child(2)>.formulario__botao"),formLoginDefaultMsg=["Digite seu e-mail","Digite sua senha","Confirme sua senha"],msgErrorEmail=["E-mail inválido"],msgErrorPWD=["Senha: Mínimo 8 dígitos","Senha: Máximo 20 dígitos","Senha: Mínimo de 1 letra minúscula (a-z)","Senha: Mínimo de 1 letra maíuscula (A-Z)","Senha: Mínimo de 1 dígito (0-9)","Senha: Mínimo de 1 símbolo (!@#$%&*-_=+-)"],msgErrorPWDConfirm=["Senhas não estão iguais"],msgLoginSuccess=["E-mail válido","Senha válida","Senha confirmada"],regexEmail=/(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9]))\.){3}(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9])|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/,regexPassword=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%&\*\-_=+-])[A-Za-z\d!@#$%&\*\-_=+-]{8,20}$/,condLoginEmail=[regexEmail],condLoginPWD=[/^.{8,}$/,/^.{0,20}$/,/[a-z]+/,/[A-Z]+/,/\d+/,/[!@#$%&\*\-_=+-]+/];var condLoginPWDConfirm=[inputNewAccPWD.value===inputNewAccPWDConfirm.value];buttonLogin.addEventListener("click",t=>{t.preventDefault();let e=inputLoginEmail.value,i=inputLoginPWD.value;loginListArray._arrayEmail.includes(e)&&loginListArray._arrayPWD.includes(i)?(sessionStorage.setItem("login",JSON.stringify({login:!0,email:i})),alert("Credenciais corretas! redirecionando..."),window.location.replace("../index.html")):alert("Email e/ou senha estão incorretos")}),buttonNewAcc.addEventListener("click",t=>{t.preventDefault(),condLoginPWDConfirm=[inputNewAccPWD.value===inputNewAccPWDConfirm.value];let e=inputNewAccEmail.value,i=inputNewAccPWD.value;inputNewAccPWDConfirm.value,regexEmail.test(e)&&regexPassword.test(i)&&condLoginPWDConfirm[0]&&(new loginHandler(e,i),alert("Conta criada com sucesso! Por favor,faça o login agora."),clearForm(formNewAcc,formLoginDefaultMsg))}),addEventListenerForm(inputNewAccLabelEmail,inputNewAccEmail,"focusout",condLoginEmail,formLoginDefaultMsg[0],msgErrorEmail,msgLoginSuccess[0]),addEventListenerForm(inputNewAccLabelPWD,inputNewAccPWD,"focusout",condLoginPWD,formLoginDefaultMsg[1],msgErrorPWD,msgLoginSuccess[1]),inputNewAccPWDConfirm.addEventListener("focusout",t=>{var e=(condLoginPWDConfirm=[inputNewAccPWD.value===inputNewAccPWDConfirm.value]).length;if(""==inputNewAccPWDConfirm.value)labelResult(inputNewAccLabelPWDConfirm.querySelector("p"),formLoginDefaultMsg[2],""),classResult(inputNewAccLabelPWDConfirm,void 0);else{for(let t=0;t<condLoginPWDConfirm.length;t++)condLoginPWDConfirm[t]||(labelResult(inputNewAccLabelPWDConfirm.querySelector("p"),msgErrorPWDConfirm,"[X]"),e--);e<condLoginPWDConfirm.length||!regexPassword.test(inputNewAccPWDConfirm.value)?classResult(inputNewAccLabelPWDConfirm,!1):(labelResult(inputNewAccLabelPWDConfirm.querySelector("p"),msgLoginSuccess[2],"[✓]"),classResult(inputNewAccLabelPWDConfirm,!0))}});